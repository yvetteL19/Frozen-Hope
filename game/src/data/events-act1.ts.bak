import { Event } from '../types';

// 第一幕事件（第2-3天）- 从5选3
export const ACT1_EVENTS: Event[] = [
  // 事件1: "权威的错误指令"
  {
    id: 'act1_who_is_leader',
    act: 1,
    name: '权威的错误指令',
    bias: 'authority_bias',
    conflict: '是否服从领导在非专业领域的决策？',
    scene: '清晨，程序员发现信标电路板受潮。他犹豫地说："这...可能需要专业处理..."你自信地说："我在管理层见过类似设备，应该直接用打火机烘干电路板！"助理低声提醒："这...可能会烧坏芯片..."但你语气强硬："听我的，我管过上千万的项目，相信我的判断。"',
    npcsInvolved: ['programmer', 'assistant'],
    choices: [
      {
        id: 'A',
        type: 'trap',
        text: '时间紧迫，先按我说的做。我的经验不会错。',
        npcSuggestion: {
          npcRole: 'sales',
          suggestsThis: true,
        },
        consequences: {
          stress: 3,
          beaconProgress: -15,
          npcState: [{ roleId: 'programmer', state: 'agitated' }],
          flags: [{ key: 'ceo_authority_established', value: true }],
          biasRecorded: 'authority_bias',
          description: '你信任了管理经验而非技术专业。电路板被烧坏，信标进度-15%。程序员沉默了。',
        },
        longTermEffects: '团队开始怀疑你的判断力',
      },
      {
        id: 'B',
        type: 'rational',
        text: '这是技术问题，应该让懂技术的人来判断。',
        consequences: {
          stress: 1,
          beaconProgress: 5,
          npcState: [{ roleId: 'sales', state: 'agitated' }],
          description: '你让专业人士做决定，但有人觉得你不够果断。信标进度+5%，但团队出现分歧。',
        },
      },
      // CEO专属
      {
        id: 'CEO_SKILL',
        type: 'skill',
        text: '[指挥] （停顿后说）...等等，我说错了。这是技术问题，程序员，你来决定。',
        roleSpecific: 'ceo',
        skillRequired: 'command',
        consequences: {
          stress: -1,
          beaconProgress: 12,
          perfectDecision: true,
          description: '完美决策！你展示了真正的领导力——承认自己的局限性。团队士气提升，成功修复。信标进度+12%。',
        },
      },
      // 销售总监专属
      {
        id: 'SALES_SKILL',
        type: 'skill',
        text: '[谈判] （打圆场）CEO，您的想法很有道理...不过为了保险起见，要不先让程序员评估一下风险？',
        roleSpecific: 'sales',
        skillRequired: 'negotiation',
        consequences: {
          stress: 0,
          playerHP: -4, // 增加谈判成本
          beaconProgress: 8,
          npcRelationship: [
            { roleId: 'sales', relationship: 'ally' },
            { roleId: 'programmer', relationship: 'ally' },
          ],
          description: '你巧妙地化解了冲突，但耗费了大量精力。信标进度+8%，团队合作更加顺畅。',
        },
      },
    ],
  },

  // 事件2: "数据驱动的陷阱"
  {
    id: 'act1_first_inventory',
    act: 1,
    name: '数据驱动的陷阱',
    bias: 'mcnamara_fallacy',
    conflict: '是否只依赖可量化指标做决策？',
    scene: '销售总监拿出笔记本："我做了统计分析——修复信标的\'产出值\'最高，急救的\'成功率\'最高，导航和野外生存的\'量化贡献\'最低。今后资源分配必须按这些数据来。"飞行员愤怒："我的导航经验、向导的生存知识，这些你怎么量化？！"',
    npcsInvolved: ['pilot', 'guide'],
    choices: [
      {
        id: 'A',
        type: 'trap',
        text: '有道理。客观数据比主观经验更可靠，我们需要科学管理。',
        consequences: {
          stress: 3,
          npcState: [
            { roleId: 'pilot', state: 'agitated' },
            { roleId: 'guide', state: 'agitated' },
          ],
          npcRelationship: [
            { roleId: 'pilot', relationship: 'hostile' },
            { roleId: 'guide', relationship: 'hostile' },
          ],
          flags: [{ key: 'quantification_obsession', value: true }],
          biasRecorded: 'mcnamara_fallacy',
          description: '你用"科学"包装了偏见。飞行员和向导感到被轻视，拒绝再分享经验。压力+3。',
        },
        longTermEffects: '飞行员和向导将不再主动提供建议',
      },
      {
        id: 'B',
        type: 'rational',
        text: '数据有用，但不是全部。有些救命的东西没法放进表格里。',
        consequences: {
          stress: 1,
          npcState: [{ roleId: 'sales', state: 'agitated' }],
          description: '你拒绝了"科学管理"，有人认为你不够理性。但飞行员和向导感激你重视他们。',
        },
      },
      // 向导专属
      {
        id: 'GUIDE_SKILL',
        type: 'skill',
        text: '[荒野智慧] （冷静地说）CEO，你能量化"在暴风雪中不迷路的直觉"吗？能量化"知道哪里有水源"的经验吗？',
        roleSpecific: 'guide',
        skillRequired: 'wilderness_wisdom',
        consequences: {
          stress: -1,
          playerHP: -8,
          npcRelationship: [
            { roleId: 'pilot', relationship: 'ally' },
            { roleId: 'guide', relationship: 'ally' },
          ],
          perfectDecision: true,
          description: '完美决策！向导用具体例子揭示了量化的局限性。你沉默了，意识到自己错了。团队明白，生存需要数据，更需要智慧。',
        },
      },
      // 程序员专属
      {
        id: 'PROGRAMMER_SKILL',
        type: 'skill',
        text: '[修复] （作为被"高估"的人）我反对。我修信标靠的是飞行员告诉我电路原理，向导找到工具。这不是我一个人的"产出"。',
        roleSpecific: 'programmer',
        skillRequired: 'repair',
        consequences: {
          stress: -2,
          playerHP: -10,
          npcRelationship: [
            { roleId: 'pilot', relationship: 'ally' },
            { roleId: 'guide', relationship: 'ally' },
            { roleId: 'programmer', relationship: 'ally' },
          ],
          perfectDecision: true,
          description: '完美决策！你主动拒绝了"特权"，强调团队协作的不可量化价值。全员士气大幅提升，压力-2。',
        },
      },
      // CEO专属
      {
        id: 'CEO_SKILL',
        type: 'skill',
        text: '[指挥] （冷静地）数据很重要，但忽视团队的经验和直觉同样是错误的。我们需要平衡。',
        roleSpecific: 'ceo',
        skillRequired: 'command',
        consequences: {
          stress: -2,
          npcRelationship: [
            { roleId: 'pilot', relationship: 'ally' },
            { roleId: 'guide', relationship: 'ally' },
          ],
          perfectDecision: true,
          description: '完美决策！你展现了真正的领导力——在数据与经验之间找到平衡。飞行员和向导感激你的理解。',
        },
      },
    ],
  },

  // 事件3: "被诅咒的信标"
  {
    id: 'act1_cursed_beacon',
    act: 1,
    name: '被诅咒的信标',
    bias: 'false_causality',
    conflict: '如何应对迷信和巧合？',
    scene: '应急信标在驾驶舱里滋滋作响。销售总监大喊："别碰它！我刚才试着重启了一下，风雪立刻就变大了！这东西被诅咒了！"',
    npcsInvolved: ['sales'],
    choices: [
      {
        id: 'A',
        type: 'trap',
        text: '宁可信其有。在这种环境下，我们承受不起更多风险。',
        consequences: {
          stress: 2,
          beaconProgress: -30,
          biasRecorded: 'false_causality',
          description: '你选择了"安全"，但实际上浪费了宝贵的时间。信标修复进度-30%，团队士气受挫。',
        },
      },
      {
        id: 'B',
        type: 'rational',
        text: '巧合而已。但为了安抚大家，让我们小心地检查一下。',
        consequences: {
          stress: 1,
          beaconProgress: 15,
          npcState: [{ roleId: 'sales', state: 'agitated' }],
          flags: [{ key: 'programmer_skill_revealed', value: true }],
          description: '你用理性战胜了恐惧，但有人仍然不安。信标修复进度15%。',
        },
      },
      // 程序员专属
      {
        id: 'PROGRAMMER_SKILL',
        type: 'skill',
        text: '[修复] 都让开，这不是诅咒，是短路。风雪只是巧合。给我十分钟。',
        roleSpecific: 'programmer',
        skillRequired: 'repair',
        consequences: {
          stress: -1, // 完美决策
          playerHP: -8,
          beaconProgress: 40,
          npcState: [{ roleId: 'sales', state: 'calm' }],
          perfectDecision: true,
          description: '完美决策！你用专业知识碾压了迷信。信标修复进度40%！',
        },
      },
      // 向导专属
      {
        id: 'GUIDE_SKILL',
        type: 'skill',
        text: '[荒野智慧] （你看了看外面）风雪没有变大。是风向变了，声音听起来更大了。',
        roleSpecific: 'guide',
        skillRequired: 'wilderness_wisdom',
        consequences: {
          stress: 0,
          playerHP: -8,
          beaconProgress: 10,
          description: '你用专业知识反驳了迷信。信标修复进度10%。',
        },
      },
    ],
  },

  // 事件4: "第一个夜晚"
  {
    id: 'act1_first_night',
    act: 1,
    name: '第一个夜晚',
    bias: 'emotional_reasoning',
    conflict: '如何应对他人的情绪崩溃？',
    scene: '夜晚降临，温度骤降至-20°C。只有2条毯子。助理在角落里哭泣："我好冷...我感觉我快死了...我不想死..."她的恐慌情绪在传染。',
    npcsInvolved: ['assistant'],
    choices: [
      {
        id: 'A',
        type: 'trap',
        text: '直接告诉她真相：情况很危险，但哭解决不了问题。',
        consequences: {
          stress: 3,
          playerHP: -15,
          npcHP: [
            { roleId: 'assistant', value: -15 },
            { roleId: 'guide', value: -10 },
            { roleId: 'pilot', value: -10 },
            { roleId: 'sales', value: -10 },
          ],
          npcState: [{ roleId: 'assistant', state: 'panicked' }],
          biasRecorded: 'emotional_reasoning',
          description: '"直言不讳"击垮了她最后的心理防线。恐慌像瘟疫般蔓延。全员HP大幅下降。',
        },
      },
      {
        id: 'B',
        type: 'neutral',
        text: '把毯子给她。现在最重要的是让她冷静下来。',
        consequences: {
          stress: 1,
          playerHP: -8,
          npcHP: [
            { roleId: 'assistant', value: -3 },
            { roleId: 'guide', value: -8 },
            { roleId: 'pilot', value: -8 },
            { roleId: 'sales', value: -8 },
            { roleId: 'programmer', value: -8 },
          ],
          npcState: [{ roleId: 'assistant', state: 'calm' }],
          description: '助理恢复冷静，但其他人在寒冷中煎熬。你做了人道的选择，但资源分配引发不满。',
        },
      },
      // 助理专属
      {
        id: 'ASSISTANT_SKILL',
        type: 'skill',
        text: '[急救] （对大家说）听着，保持冷静！恐慌会加速热量流失。我们所有人挤在一起...',
        roleSpecific: 'assistant',
        skillRequired: 'first_aid',
        consequences: {
          stress: -1,
          playerHP: -10, // 增加技能成本
          npcHP: [
            { roleId: 'assistant', value: -6 }, // 增加NPC损失
            { roleId: 'guide', value: -6 },
            { roleId: 'pilot', value: -6 },
            { roleId: 'sales', value: -6 },
          ],
          npcState: [{ roleId: 'programmer', state: 'agitated' }], // 增加副作用：程序员烦躁
          flags: [{ key: 'assistant_skill_revealed', value: true }],
          description: '你稳定了团队情绪，但消耗巨大。程序员对拥挤不满。全员HP-6。',
        },
      },
      // 飞行员专属
      {
        id: 'PILOT_SKILL',
        type: 'skill',
        text: '[机械知识] 哭没用。把这个座位上的隔音棉扯下来！它能保暖。',
        roleSpecific: 'pilot',
        skillRequired: 'mechanical_knowledge',
        consequences: {
          stress: 1, // 改为+1压力（命令式语气引发不满）
          playerHP: -12, // 增加技能成本
          npcHP: [
            { roleId: 'assistant', value: -4 },
            { roleId: 'sales', value: -2 },
            { roleId: 'sales', value: -2 },
          ],
          npcState: [{ roleId: 'assistant', state: 'agitated' }], // 助理被粗鲁语气刺激
          description: '你找到保暖材料，但语气粗暴刺激了助理的情绪。全员HP-4，助理HP-4。',
        },
      },
    ],
  },

  // 事件5: "飞行员的腿"
  {
    id: 'act1_pilots_leg',
    act: 1,
    name: '飞行员的腿',
    bias: 'sunk_cost',
    conflict: '是否应该继续一个已经失败的救援方案？',
    prerequisites: [{ type: 'npc_alive', target: 'pilot', value: true }],
    scene: '飞行员的腿被座椅残骸卡住了，血流不止。你们已经花了一个小时试图把他拉出来，但他疼得大叫，残骸在晃动。销售总监："我们已经花了一个小时了！再试一次，一定能行！"',
    npcsInvolved: ['pilot', 'sales'],
    choices: [
      {
        id: 'A',
        type: 'trap',
        text: '不能放弃！他还有意识，说明还有机会。再试一次！',
        consequences: {
          stress: 4,
          playerHP: -25,
          npcDeath: ['pilot'],
          biasRecorded: 'sunk_cost',
          description: '你的坚持触发了二次坍塌。飞行员死亡。你在救援中受伤，HP-25。',
        },
      },
      {
        id: 'B',
        type: 'rational',
        text: '停下。我们需要工具，不能用蛮力。',
        consequences: {
          stress: 2,
          npcHP: [{ roleId: 'pilot', value: -20 }],
          npcState: [{ roleId: 'sales', state: 'agitated' }],
          flags: [{ key: 'assistant_skill_revealed', value: true }],
          description: '你选择了等待，飞行员多流了血（HP-20）。有人指责你见死不救。但他活着。',
        },
      },
      // 飞行员专属
      {
        id: 'PILOT_SKILL',
        type: 'skill',
        text: '[机械知识] （忍痛大喊）别拉了！去把液压管切断！那里的压力泄了，座位就能松开！',
        roleSpecific: 'pilot',
        skillRequired: 'mechanical_knowledge',
        consequences: {
          stress: 0,
          playerHP: -38, // -8技能 -30伤害
          description: '你被成功救出，但腿部重伤。HP-30。',
        },
      },
      // 助理专属
      {
        id: 'ASSISTANT_SKILL',
        type: 'skill',
        text: '[急救] 都住手！你们在杀了他！我这里有止痛剂...我先给他注射。',
        roleSpecific: 'assistant',
        skillRequired: 'first_aid',
        consequences: {
          stress: 0,
          playerHP: -3,
          npcHP: [{ roleId: 'pilot', value: -5 }],
          npcState: [{ roleId: 'pilot', state: 'calm' }],
          items: [{ item: 'medkit', quantity: -1 }],
          description: '飞行员暂时脱离危险并恢复冷静，团队也平静下来。飞行员HP-5（比强行移动少损失5HP）。',
        },
      },
      // CEO专属（技能陷阱）
      {
        id: 'CEO_SKILL_TRAP',
        type: 'skill',
        text: '[指挥] （对销售总监）说得对！（对团队）所有人，听我指挥，1...2...3...拉！',
        roleSpecific: 'ceo',
        skillRequired: 'command',
        consequences: {
          stress: 4, // +1技能 +3陷阱
          playerHP: -20,
          npcHP: [{ roleId: 'pilot', value: -60 }], // 重伤但不死
          npcState: [{ roleId: 'pilot', state: 'panicked' }],
          biasRecorded: 'sunk_cost',
          description: '技能陷阱！你的强行指挥造成二次坍塌。飞行员遭受重创（HP-60），陷入恐慌。',
        },
      },
    ],
  },

  // 事件6: "乐观的陷阱"
  {
    id: 'act1_optimism_trap',
    act: 1,
    name: '乐观的陷阱',
    bias: 'optimism_bias',
    conflict: '是否应该为最坏情况做准备？',
    scene: '销售总监充满自信地说："大家听好，救援队肯定今天就会到。我们把所有的信号弹都发射出去，让他们更容易找到我们！"向导皱眉："可是...如果今天不来呢？我们只有3发信号弹..."',
    npcsInvolved: ['guide'],
    choices: [
      {
        id: 'A',
        type: 'trap',
        text: '保持积极！乐观能提振士气。集中火力，增加被发现的概率！',
        npcSuggestion: {
          npcRole: 'sales',
          suggestsThis: true,
        },
        consequences: {
          stress: 3,
          beaconProgress: -10,
          flags: [{ key: 'flares_wasted', value: true }],
          biasRecorded: 'optimism_bias',
          description: '乐观没有换来救援。信号弹耗尽，你们失去了未来的求救手段。信标进度-10%。',
        },
        longTermEffects: '后续无法发射信号弹',
      },
      {
        id: 'B',
        type: 'rational',
        text: '做最坏的打算。每天只用一发，谁知道要等多久。',
        npcSuggestion: {
          npcRole: 'guide',
          suggestsThis: true,
        },
        consequences: {
          stress: 1,
          beaconProgress: 5,
          npcState: [{ roleId: 'sales', state: 'agitated' }],
          npcHP: [{ roleId: 'assistant', value: -5 }],
          description: '你的悲观让一些人感到绝望，助理情绪低落（HP-5）。但你保住了资源。信标进度+5%。',
        },
      },
      // 向导专属
      {
        id: 'GUIDE_SKILL',
        type: 'skill',
        text: '[荒野智慧] 等等，我知道什么时候发射最有效。让我根据天气和能见度来判断。',
        roleSpecific: 'guide',
        skillRequired: 'wilderness_wisdom',
        consequences: {
          stress: -1,
          playerHP: -8,
          beaconProgress: 15,
          perfectDecision: true,
          description: '完美决策！你用专业知识选择了最佳时机。信号弹在能见度最好时发射，被路过的飞机发现！信标进度+15%。',
        },
      },
      // CEO专属
      {
        id: 'CEO_SKILL',
        type: 'skill',
        text: '[指挥] （停顿后）...等等，我需要考虑最坏情况。向导，你来制定信号弹使用计划。',
        roleSpecific: 'ceo',
        skillRequired: 'command',
        consequences: {
          stress: -1,
          beaconProgress: 10,
          perfectDecision: true,
          description: '完美决策！你展示了真正的领导力——克服自己的乐观偏误。向导制定了合理计划，信标进度+10%。',
        },
      },
    ],
  },

  // 事件7: "逆火效应"
  {
    id: 'act1_backfire_effect',
    act: 1,
    name: '逆火效应',
    bias: 'backfire_effect',
    conflict: '当证据与信念冲突时，如何说服他人？',
    scene: '助理发现了一张坠机前的天气图："看！雷达显示我们飞入了强风暴区，飞行员当时根本看不清！"但销售总监坚持："不可能！我亲眼看到飞行员在喝咖啡不专心！这张图是假的！"',
    npcsInvolved: ['assistant', 'sales', 'pilot'],
    prerequisites: [{ type: 'npc_alive', target: 'pilot', value: true }],
    choices: [
      {
        id: 'A',
        type: 'trap',
        text: '找到责任人很重要。这能帮助我们避免未来的错误。',
        consequences: {
          stress: 2,
          npcHP: [{ roleId: 'pilot', value: -10 }],
          npcState: [{ roleId: 'pilot', state: 'agitated' }],
          npcRelationship: [{ roleId: 'pilot', relationship: 'hostile' }],
          biasRecorded: 'backfire_effect',
          description: '"追责"变成了"猎巫"。飞行员感到被冤枉，陷入自我怀疑（HP-10）。团队出现裂痕。',
        },
      },
      {
        id: 'B',
        type: 'rational',
        text: '现在追责没有意义。我们需要飞行员的专业知识活下去。',
        consequences: {
          stress: 1,
          npcState: [{ roleId: 'sales', state: 'agitated' }],
          npcRelationship: [{ roleId: 'pilot', relationship: 'ally' }],
          description: '你放弃了"真相"，有人觉得你在包庇。但飞行员感激你的信任。',
        },
      },
      // 助理专属
      {
        id: 'ASSISTANT_SKILL',
        type: 'skill',
        text: '[急救] （冷静地）我理解你们的感受。但责怪他人不会帮助我们生存。我们现在需要飞行员的专业知识。',
        roleSpecific: 'assistant',
        skillRequired: 'first_aid',
        consequences: {
          stress: -1,
          playerHP: -3,
          npcState: [
            { roleId: 'sales', state: 'calm' },
            { roleId: 'pilot', state: 'calm' },
          ],
          perfectDecision: true,
          description: '完美决策！你用同理心化解了冲突。大家都恢复冷静。团队凝聚力提升。',
        },
      },
      // 飞行员专属
      {
        id: 'PILOT_SKILL',
        type: 'skill',
        text: '[机械知识] （拿出飞行记录仪）这是黑匣子的数据。雷达显示风速超过120节。没有任何飞行员能在这种情况下避开风暴。',
        roleSpecific: 'pilot',
        skillRequired: 'mechanical_knowledge',
        consequences: {
          stress: 0,
          playerHP: -8,
          npcState: [{ roleId: 'sales', state: 'calm' }],
          beaconProgress: 5,
          perfectDecision: true,
          description: '完美决策！你用无可辩驳的证据说服了大家。团队沉默地接受了事实。信标进度+5%（飞行记录仪提供了有用信息）。',
        },
      },
    ],
  },
];
